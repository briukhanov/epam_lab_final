pipeline {

    agent any

    stages {

        stage('Check Terraform version') {
            steps {
               sh 'terraform --version'
            }
        }
        stage('Provision infrastructure (init)') {
            environment {
                AWS_CRED=credentials('AWS-pipeline')
                AWS_ACCESS_KEY_ID = "${env.AWS_CRED_USR}"
                AWS_SECRET_ACCESS_KEY = "${env.AWS_CRED_PSW}"
            }
            steps {
                sh '''
                terraform init -input=false
                terraform workspace select dev
                terraform destroy -auto-approve
                '''
            }
        }
      }
}
